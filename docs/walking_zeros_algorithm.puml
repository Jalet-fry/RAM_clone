@startuml walking_zeros_algorithm
!theme plain

title Алгоритм Walking 0s

start

:Инициализация:\nОчистка результатов\nПолучение размера памяти;

if (Размер памяти > 0?) then (нет)
    :Установить прогресс 100%;
    :Отправить пустые результаты;
    stop
endif

:Фаза 1: Запись паттернов;

repeat
    :Для адреса a от 0 до n-1;
    :Вычислить паттерн:\npattern = ~(1u << (a % 32));
    :Записать pattern в адрес a\nwriteDirect(a, pattern);
    :Обновить прогресс:\nbasePercent = 0%\nphasePercent = 50%;
repeat while (a < n-1?)

:Фаза 2: Чтение и проверка;

repeat
    :Для адреса a от 0 до n-1;
    :Вычислить ожидаемое значение:\nexpected = ~(1u << (a % 32));
    :Прочитать значение из адреса a\nread(a);
    :Применить неисправность\nесли она внедрена;
    if (read == expected?) then (да)
        :passed = true;
    else (нет)
        :passed = false;
    endif
    :Сохранить результат:\nTestResult(a, expected, read, passed);
    :Обновить прогресс:\nbasePercent = 50%\nphasePercent = 50%;
    if (a % 10 == 0?) then (да)
        :Отправить детали прогресса;
    endif
repeat while (a < n-1?)

:Установить прогресс 100%;
:Отправить результаты;

stop

@enduml

